<div class="row">
  <div class="col-md-8 offset-md-2">
    <h1> Import Books from CSV</h1>
    
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Upload CSV File</h5>
        
        <%= form_with url: imports_path, method: :post, local: true, multipart: true do |form| %>
          <div class="mb-3">
            <%= label_tag :user_email, "Your Email", class: "form-label" %>
            <%= email_field_tag :user_email, nil, class: "form-control", placeholder: "admin@example.com", required: true %>
            <div class="form-text">You will receive import results to this email</div>
          </div>
          
          <div class="mb-3">
            <%= label_tag :csv_file, "CSV File", class: "form-label" %>
            <%= file_field_tag :csv_file, accept: ".csv", class: "form-control", required: true %>
          </div>
          
          <div class="alert alert-info">
            <strong>CSV Format:</strong>
            <p class="mb-0">The CSV file should have the following columns:</p>
            <ul class="mb-0">
              <li><code>title</code> - Book title (required)</li>
              <li><code>author_name</code> - Author name (must exist in database)</li>
              <li><code>year</code> - Publication year (required)</li>
              <li><code>description</code> - Book description (optional)</li>
            </ul>
          </div>
          
          <%= submit_tag "Import Books", class: "btn btn-primary" %>
          <%= link_to "Cancel", imports_path, class: "btn btn-secondary" %>
        <% end %>
      </div>
    </div>
    
    <!-- Приклад CSV -->
    <div class="card mt-4">
      <div class="card-body">
        <h5 class="card-title">Example CSV</h5>
        <pre class="bg-light p-3"><code>title,author_name,year,description
"1984","George Orwell",1949,"A dystopian novel"
"Animal Farm","George Orwell",1945,"An allegorical novella"
"Pride and Prejudice","Jane Austen",1813,"A romantic novel"</code></pre>
        
        <%= link_to "Download Example CSV", "#", class: "btn btn-sm btn-outline-primary", 
            onclick: "downloadExampleCSV(); return false;" %>
      </div>
    </div>
  </div>
</div>

<script>
function downloadExampleCSV() {
  const csv = `title,author_name,year,description
"1984","George Orwell",1949,"A dystopian novel"
"Animal Farm","George Orwell",1945,"An allegorical novella"
"Pride and Prejudice","Jane Austen",1813,"A romantic novel"`;
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'books_example.csv';
  a.click();
  window.URL.revokeObjectURL(url);
}
</script>