<div class="container-fluid p-0">
  <div class="mb-3">
    <h1 class="h3 d-inline align-middle">Bookshelf</h1>
    <%= link_to "Authors", authors_path, class: "btn btn-info float-end ms-2" %>
    <%= link_to "New Book", new_book_path, class: "btn btn-primary float-end" %>
  </div>

  <div class="row">
    <div class="col-12">
      <!-- Форма пошуку та сортування -->
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="card-title mb-0">Search & Sort</h5>
        </div>
        <div class="card-body">
          <%= form_with url: books_path, method: :get, local: true do %>
            <div class="row g-3">
              <div class="col-md-4">
                <%= text_field_tag :search_title, params[:search_title], 
                    class: "form-control", 
                    placeholder: "Search by title..." %>
              </div>
              <div class="col-md-3">
                <%= text_field_tag :search_author, params[:search_author], 
                    class: "form-control", 
                    placeholder: "Search by author..." %>
              </div>
              <div class="col-md-3">
                <%= select_tag :sort, 
                    options_for_select([
                      ["Sort by...", ""],
                      ["Title (A-Z)", "title_asc"],
                      ["Title (Z-A)", "title_desc"],
                      ["Year (Old to New)", "year_asc"],
                      ["Year (New to Old)", "year_desc"]
                    ], params[:sort]), 
                    class: "form-select" %>
              </div>
              <div class="col-md-2">
                <%= submit_tag "Search", class: "btn btn-primary w-100" %>
              </div>
            </div>
            <% if params[:search_title].present? || params[:search_author].present? || params[:sort].present? %>
              <div class="mt-2">
                <%= link_to "Clear filters", books_path, class: "btn btn-sm btn-secondary" %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- Таблиця книг -->
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            All Books 
            <span class="badge bg-primary"><%= @books.count %></span>
          </h5>
        </div>
        <div class="card-body">
          <% if @books.any? %>
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Year</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @books.each do |book| %>
                    <tr>
                      <td>
                        <%= link_to book.title, book_path(book), class: "text-decoration-none" %>
                      </td>
                      <td>
                        <% if book.author %>
                          <%= link_to book.author.name, author_path(book.author), class: "text-decoration-none" %>
                          <% unless book.author.active %>
                            <span class="badge bg-warning text-dark">Inactive</span>
                          <% end %>
                        <% else %>
                          <span class="text-muted">Unknown</span>
                        <% end %>
                      </td>
                      <td><%= book.year %></td>
                      <td class="text-end">
                        <%= link_to "Show", book_path(book), class: "btn btn-sm btn-info" %>
                        <%= link_to "Edit", edit_book_path(book), class: "btn btn-sm btn-warning" %>
                        <%= button_to "Delete", book_path(book), 
                                      method: :delete, 
                                      data: { turbo_confirm: "Are you sure?" }, 
                                      class: "btn btn-sm btn-danger" %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="alert alert-info">
              <p class="mb-0">
                No books found. 
                <% if params[:search_title].present? || params[:search_author].present? %>
                  Try <%= link_to "clearing filters", books_path %> or
                <% end %>
                <%= link_to "add your first book", new_book_path %>.
              </p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>